<div id="image-area">
    <div class="placeholder">
        [ SCENE IMAGE ({{ state.player.current_node }}) ]
    </div>
</div>

<div id="description-area">
    <div class="scene-description">
        {{ state.get_current_description() }}
        <br>
        <small>Node: {{ state.player.current_node }}, Turn: {{ state.turn }}</small>
    </div>

    {% if let Some(node) = state.world.nodes.get(state.player.current_node.as_str()) %}
    {% if !node.items.is_empty() %}
    <div class="items-here" style="margin-top: 10px; color: #aaa;">
        <strong>Items here:</strong> 
        {% for item_id in node.items %}
            {% if let Some(item) = state.world.items.get(item_id.as_str()) %}
                <span title="{{ item.description }}">{{ item.name }}</span>{% if !loop.last %}, {% endif %}
            {% else %}
                {{ item_id }}{% if !loop.last %}, {% endif %}
            {% endif %}
        {% endfor %}
    </div>
    {% endif %}
    {% endif %}

    <div class="inventory-area" style="margin-top: 10px; color: #88ccff;">
        <strong>Inventory:</strong>
        {% if state.player.inventory.is_empty() %}
            Empty
        {% else %}
            {% for item_id in state.player.inventory %}
                {% if let Some(item) = state.world.items.get(item_id.as_str()) %}
                    <span title="{{ item.description }}">{{ item.name }}</span>{% if !loop.last %}, {% endif %}
                {% else %}
                    {{ item_id }}{% if !loop.last %}, {% endif %}
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>
    
    <div id="ui-controls" style="margin-top: 10px; display: flex; flex-wrap: wrap; gap: 10px;">
        {% if let Some(node) = state.world.nodes.get(state.player.current_node.as_str()) %}
            {% for edge in node.edges %}
                {% if state.can_traverse(edge) %}
                <button hx-post="/game/{{ run_id }}/command" 
                        hx-vals='{"command": "{{ edge.target_id }}"}'
                        hx-target="#game-container"
                        style="background: #222; color: #00ff00; border: 1px solid #444; padding: 5px 10px; cursor: pointer;">
                    {{ edge.label }}
                </button>
                {% else %}
                <button disabled
                        style="background: #111; color: #444; border: 1px solid #222; padding: 5px 10px; cursor: not-allowed;">
                    {{ edge.label }} (Locked)
                </button>
                {% endif %}
            {% endfor %}
        {% endif %}
        <a href="/game/{{ run_id }}/export" target="_blank" style="color: #888; text-decoration: none; border: 1px solid #444; padding: 5px 10px;">[ EXPORT YAML ]</a>
    </div>
</div>

<div id="history-area">
    <div id="history">
        {% for entry in state.log %}
        <div class="message">{{ entry }}</div>
        {% endfor %}
    </div>
</div>

<form id="input-area" hx-post="/game/{{ run_id }}/command" hx-target="#game-container" hx-swap="innerHTML">
    <span>&gt;</span>
    <input type="text" 
           id="command-input" 
           name="command" 
           autofocus 
           autocomplete="off"
           list="suggestions"
           placeholder="Type a command or click a button..."
           hx-get="/game/{{ run_id }}/suggest"
           hx-trigger="input changed delay:100ms"
           hx-target="#suggestions">
    <datalist id="suggestions">
        <!-- Autocomplete list is filled dynamically -->
    </datalist>
</form>
