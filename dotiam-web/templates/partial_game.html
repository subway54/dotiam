<div id="image-area">
    <div class="placeholder">
        [ SCENE IMAGE ({{ state.player.pos.x }}, {{ state.player.pos.y }}) ]
    </div>
</div>

<div id="description-area">
    <div class="scene-description">
        {{ state.get_current_description() }}
        <br>
        <small>Position: ({{ state.player.pos.x }}, {{ state.player.pos.y }}), Turn: {{ state.turn }}</small>
    </div>
    
    <div id="ui-controls" style="margin-top: 10px; display: flex; gap: 10px;">
        {% if edit_mode %}
        <a href="/game/{{ run_id }}?edit=false" hx-get="/game/{{ run_id }}?edit=false" hx-target="#game-container" hx-push-url="true" style="color: #ff0000; text-decoration: none; border: 1px solid #ff0000; padding: 2px 5px;">[ EXIT EDIT MODE ]</a>
        <form hx-post="/game/{{ run_id }}/edit_tile" hx-target="#game-container" style="display: inline;">
            <select name="tile_type" onchange="this.form.requestSubmit()" style="background: #222; color: #00ff00; border: 1px solid #333; font-family: inherit;">
                <option value="Plains" {% match state.world.tiles.get(state.player.pos) %}{% when Some(t) %}{% match t.tile_type %}{% when dotiam_core::TileType::Plains %}selected{% else %}{% endmatch %}{% when None %}{% endmatch %}>Plains</option>
                <option value="Forest" {% match state.world.tiles.get(state.player.pos) %}{% when Some(t) %}{% match t.tile_type %}{% when dotiam_core::TileType::Forest %}selected{% else %}{% endmatch %}{% when None %}{% endmatch %}>Forest</option>
                <option value="Ruins" {% match state.world.tiles.get(state.player.pos) %}{% when Some(t) %}{% match t.tile_type %}{% when dotiam_core::TileType::Ruins %}selected{% else %}{% endmatch %}{% when None %}{% endmatch %}>Ruins</option>
                <option value="Cave" {% match state.world.tiles.get(state.player.pos) %}{% when Some(t) %}{% match t.tile_type %}{% when dotiam_core::TileType::Cave %}selected{% else %}{% endmatch %}{% when None %}{% endmatch %}>Cave</option>
            </select>
        </form>
        {% else %}
        <a href="/game/{{ run_id }}?edit=true" hx-get="/game/{{ run_id }}?edit=true" hx-target="#game-container" hx-push-url="true" style="color: #888; text-decoration: none; border: 1px solid #444; padding: 2px 5px;">[ EDIT MODE ]</a>
        {% endif %}
        <a href="/game/{{ run_id }}/export" target="_blank" style="color: #888; text-decoration: none; border: 1px solid #444; padding: 2px 5px;">[ EXPORT YAML ]</a>
        <a href="/game/{{ run_id }}/editor" style="color: #00ff00; text-decoration: none; border: 1px solid #00ff00; padding: 2px 5px;">[ ASCII EDITOR ]</a>
    </div>
</div>

<div id="history-area">
    <div id="history">
        {% for entry in state.log %}
        <div class="message">{{ entry }}</div>
        {% endfor %}
    </div>
</div>

<form id="input-area" hx-post="/game/{{ run_id }}/command{% if edit_mode %}?edit=true{% endif %}" hx-target="#game-container" hx-swap="innerHTML">
    <span>&gt;</span>
    <input type="text" 
           id="command-input" 
           name="command" 
           autofocus 
           autocomplete="off"
           list="suggestions"
           placeholder="Type a command..."
           hx-get="/game/{{ run_id }}/suggest{% if edit_mode %}?edit=true{% endif %}"
           hx-trigger="input changed delay:100ms"
           hx-target="#suggestions">
    <datalist id="suggestions">
        <!-- Autocomplete list is filled dynamically -->
    </datalist>
</form>
